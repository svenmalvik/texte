# Hvordan Sopra Steria drifter NAVs største IT-prosjekt.
**Foreldrepengeprosjektet er en del av Prosjekt 2 i moderniseringen av IKT i NAV. Målet med prosjektet er å lage en moderne saksbehandlingsløsning og nye digitale tjenester, med vekt på forenkling, digitalisering og automatisering. Men hvordan startet vi å drifte løsningen og hvordan jobber vi dag?**

Vi startet med en liten prototype som jeg likte å kalle for ’hobby-prosjekt’. Det betyr ikke at vi ikke tok det på alvor, tvert imot. I stedet for å sette alt på plass for en stor løsning her og nå, forholdte vi oss til det som var i dag, et lite program som vil vokse. Vår oppgave i driftsteamet var å passe på at applikasjonen alltid er produksjonsklar. Det betydde for oss å sørge for at alle endringene i kodebasen øyeblikkelig blir verifisert, og utviklerne fortest mulig får tilbakemelding om noe er feil.

Det første vi satte opp var en Jenkins Pipeline som bygger og deployer løsningen etter hver endring i kodebasen. Pipelinen skulle være enkel og forståelig. Den har derfor kun tre steg: Init, Build, Deploy. Siste steget deployer applikasjonen til en JBoss server. Når løsningen er bygget og deployet, så vil det neste verifiserte bygget overstyre den gamle versjonen som kjører på JBoss. Versjonen skal altså ikke testes manuelt, dette gjør vi senere på en annen JBoss server og en annen host. Men, hvorfor deployer vi løsningen hvis vi ikke terster den? Det hender at ny innførte tredjeparts-biblioteker som allerede kommer med JBoss, men i en annen versjon, skaper oppstartsproblemer for løsningen. Vi opplevde dette med jaxrs for eksempel. Slike avhengighetsproblemer må identifiseres før vi tester manuelt. Men avhengigheter er ikke det eneste som vi verifiserer.

Vi må også passe på at endringer i datamodellen ikke ødelegger eksiterende (test)data i systemtestmiljøet til kunden. For eksmpel kunne vi hatt en tabell <Person> med to kollonner „ID“ og „NAVN“. En entry i tabellen kunne vært ID=1 og NAVN=“Malvik, Sven“. Den nye datamodellen sier nå at tabellen ikke har to, men tre kolonner, „ID“, „FORNAVN“ og „ETTERNAVN“. Alle eksisterende (test)dataer må derfor migreres til den nye datamodellen. Måten vi gjør dette på er at vi først deployer den datamodellen som ble allerde levert til kunden. Etterpå deployer vi våre datamodellendringer som inneholder eventuelle migreringer. Vi baserer en database-deploy altså alltid på den forrige leveransen.

Kvalitet og stabilitet er kjempe viktig. Det gjelder også selve kodebasen. Vi bruker SonarQube. Vi kjører kodebasen regelmessig fra Jenkins gjennom SonarQube, på morgenen, ved lunsjtid og på ettermiddagen. Eventuelle funn blir automatisk assignet til utviklerne og en mail blir sendt ut.

Etterhvert flere utviklere "jointe" oss og løsningen vokste, fikk vi nye utfordringer. Hovedbranchen, det er develop branchen, feilet oftere og våre manuelle tester tok ofte mer tid enn planlagt. Vi valgte en annen branchingstrategi for å sikre bedre stabilitet. Hittil hadde alle pushet til develop branchen, og kun noen valgte feature branches. Vår 2017 gikk hele prosjektet over til feature branches. Disse blir testet grundig før de blir merget inn til develop branchen.

De tre første måneder gikk veldig fort, og vi brukte tiden til å lære om NAV og deres verktøy. Jeg er fortsatt fasinert over det NAV IKT har oppnådd de siste årene med sine selvbetjeningssystemer. For meg var det naturlig å bestille en server og så vente i noen uker. I NAV rekker du ikke en gang å hente kaffe. Selvbetjeningssystemet gjør oss uavhengig fra de som drifter infrastrukturen i NAV.

Og så flyttet Docker, Kubernetes og noen andre verktøy som til sammen ble døpt for NAIS (NAV Application Infrastructure Service - nais.io), inn i NAV sine kontorer. Med dem kom ett sterkt ønske om færre miljøer. Hittil kunne alle jobbe på hvert sitt feature branch og teste i hvert sitt miljø, helt uavhengig fra hverandre. Fra nå av skulle vi helst teste i ett og samme miljø. For oss betydde det at vi måtte release oftere, minst en gang i døgnet. I DevOps-verden høres det ikke uvanlig ut, og teknisk sett er det ingenting i veien med det. Vårt problem er at vi er mange, rundt 30-40 stykker, som gjør endringer i hovedapplikasjonen. Develop-branchen endrer seg veldig fort, som gjør testing i ett og samme miljø vanskelig og nesten umulig.

## Konklusjon
Både NAV og vi tilpasser oss i dag. Vi begynner å jobbe med feature toggles, kortlevende feature branches om nødvendig i det hele tatt, og kontinuerlig manuell testing. Utover det får vi enda flere automatiske tester. Kontinuerlig leveranse - DevOps - står i dag høyt på agendaen hos NAV.

