# Når Docker hjelper deg og ikke er et hinder

Høst 2016 startet jeg i DevOps avdelingen hos Sopra Steria. Jeg var heldig og kom i oppdrag med en gang. Jeg skulle hjelpe oppdragsgiveren med å få opp en infrastruktur av mikrotjenester som lever i ett Docker miljø. Teknologien var relativt nytt for meg og læringskurven var bratt. Vi var to som jobbet på driftssiden, og for begge oss var denne nye verden ukjent landskap. I dette innlegget vil jeg ikke gå inn på hvordan Docker fungerer eller hva som er fordelene eller utfordringene med Docker. I stedet vil jeg si litt om når jeg menter at man bør bruke Docker og kontainerisere sin applikasjon og når man kansje heller bør la være. 

## 

For noen år siden skrev jeg et Python programm som sørger for å få flere Twitter følgere. Jeg vet, hvoror skulle man lage et slikt programm i det hele tatt? Svaret er: fordi jeg kan. Programmet hadde noen avhengigheter til Python moduler som jeg installerte med Pip. Jeg husker at installasjonen av Python og Pip ikke var rett fram. Ubuntu versjonen jeg brukte kom med Python 2, men jeg trengte Python 3 og en tilsavrende Pip versjon. Det tok noe tid å få dette alt på plass. Det er som det er, teknologier som man ikke bruker ofte krever mer tid fordi man er nøft å sette seg inn i disse først. Derfor puttet jeg programmet inn i et Docker image, og så unngå instalasjon av Python, Pip og modulene senere en gang til. 
To år senere trengte jeg dette programmet igjen. Jeg hadde selvføleglig ingen anelse på hvordan jeg skulle installere, stoppe eller hvordan jeg måtte konfigurere programmet. Eneste jeg viste var at jeg brukte Python og at jeg hadde laget et Docker image som lå på min docker hub side. For å starte en applikasjon som kjører inn i en Docker kontainer kjører man som regel „docker run <repo/navn>“. Det gjald selvføleglig også min Docker applikasjon. Jeg slapp heldigvis å bruke mye tid på å finne ut av hvordan jeg skulle få opp applikasjonen min. Docker hjalp meg med å komme rask i gang. Det eneste jeg trengte på min maskin var Docker, ingenting annet. 

I et profesjonelt miljø vil det nok ikke være så enkelt. Der har vi flere Docker hosts, flere ulike applikasjoner (Docker images), lastbalanserer, og kontainerne trenger hver sine konfigurasjoer, Docker som teknologie kommer nesten aldri alene. Noe av behovene dekkes av for eksempel Kubernetes. Kubernetes fungerer som en slags paraply for Docker, men dekker heller ikke alt. Det jeg vil si er følgende: En velfungerende Dockerplattform krever mye kunnskap om mange andre teknologier enn kun Docker og applikasjonen vi skal kjøre. De aller fleste utviklere har kunnskap om Git, Maven og Jenkins, og mange av dem kan også skrive en Dockerfil. De som ikke kan det lærer det fort. Men, å drifte en Dockerplattform er en fulltidsjobb.  Det er derfor viktig å være bevist på om man vil bruke Docker eller ikke. 
Jeg vil påstå at, og det er sikkert noen som er uenig med meg, Docker som Plattform as a Service (DPaaS) er en forutsettning for at et professjonelt prosjekt bør bruke Docker. 
NAIS er en slik Dockerplattform. Den består av Docker - selvføleglig -, Kubernetes, Træfik, Grafana, InfluxDB og mange andre teknologier. NAIS vedlikeholdes av et dedikert team som sørger for at plattformen er enkelt å bruke og stabil i forhold til oppetid av applikasjonene som kjører på. For oss utviklerne betyr NAIS en forenkling av hverdagen vår. Før vi hadde NAIS deployet vi hver instans av en applikasjon til en egen JBoss server som kjørte på hver sin host. Mange JBoss servere på mange hosts betyr mer konfigurasjon som vi måtte håndtere. Med NAIS slipper vi dette. Vi sier til NAIS at vi ønsker å deploye en applikasjon, og at den skal deployes med for eksempel 3 instanser. NAIS sprer disse instansene utover eksisterende hosts. Skulle en host ha problemer og må restartes - det betyr at Docker kontainerne som kjører applikasjonene stoppes - så starter NAIS (Kubernetes) disse på en annen host, helt automastisk. DPaaS gjør at utviklerne er mindre avhengig av de som som har driftet JBoss serverne, og som var den typiske flaskehalsen. Med DPaaS får utviklerne litt mer ansvar i forhold til drift fordi Dockerfilen som beskriver hvordan applikasjonen kjører, er blitt en del av prosjektet. Dockerfilen ligger fysisk sammen med applikasjonskoden.   

## Konklusjon